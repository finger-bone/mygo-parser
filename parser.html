<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLR(1)è§£æå™¨å¯è§†åŒ–</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 0 auto;
            max-width: 1200px;
        }
        h1, h2, h3 {
            text-align: center;
            color: #333;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #e0e0e0;
            border: none;
            cursor: pointer;
            margin: 0 5px;
            border-radius: 4px;
            font-size: 16px;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .item-set {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        .item-set-header {
            background-color: #f2f2f2;
            padding: 8px;
            margin: -10px -10px 10px -10px;
            border-radius: 4px 4px 0 0;
            font-weight: bold;
        }
        .item {
            margin: 5px 0;
            padding: 5px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .terminal {
            color: #e91e63;
            font-weight: bold;
        }
        .non-terminal {
            color: #2196F3;
            font-weight: bold;
        }
        .production-list {
            margin-bottom: 20px;
        }
        .production {
            margin: 5px 0;
            padding: 5px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .scrollable {
            overflow-x: auto;
            max-width: 100%;
        }
        .legend {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
        }
        .action-shift {
            background-color: #e3f2fd;
        }
        .action-reduce {
            background-color: #ffebee;
        }
        .action-accept {
            background-color: #e8f5e9;
            font-weight: bold;
        }
        .action-error {
            background-color: #ffebee;
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SLR(1)è§£æå™¨å¯è§†åŒ–</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'parse-table')">è§£æè¡¨</button>
            <button class="tab" onclick="openTab(event, 'item-sets')">é¡¹ç›®é›†æ—</button>
            <button class="tab" onclick="openTab(event, 'productions')">äº§ç”Ÿå¼</button>
        </div>
        
        <div id="parse-table" class="tab-content active">
            <h2>SLR(1)è§£æè¡¨</h2>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e3f2fd;"></div>
                    <span>ç§»è¿›æ“ä½œ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffebee;"></div>
                    <span>è§„çº¦æ“ä½œ</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e8f5e9;"></div>
                    <span>æ¥å—æ“ä½œ</span>
                </div>
            </div>
            
            <div class="scrollable">
                <table id="action-table">
                    <thead>
                        <tr>
                            <th rowspan="2">çŠ¶æ€</th>
                            <th colspan="1" id="action-colspan">ACTION</th>
                            <th colspan="1" id="goto-colspan">GOTO</th>
                        </tr>
                        <tr id="table-header">
                            <!-- åŠ¨æ€ç”Ÿæˆè¡¨å¤´ -->
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- åŠ¨æ€ç”Ÿæˆè¡¨å†…å®¹ -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="item-sets" class="tab-content">
            <h2>é¡¹ç›®é›†æ—</h2>
            <div id="item-sets-container">
                <!-- åŠ¨æ€ç”Ÿæˆé¡¹ç›®é›† -->
            </div>
        </div>
        
        <div id="productions" class="tab-content">
            <h2>äº§ç”Ÿå¼</h2>
            <div class="production-list" id="production-list">
                <!-- åŠ¨æ€ç”Ÿæˆäº§ç”Ÿå¼ -->
            </div>
        </div>
    </div>
    
    <script>
        // æ‰“å¼€æ ‡ç­¾é¡µ
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            const tabs = document.getElementsByClassName("tab");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove("active");
            }
            
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }
        
        // è·å–åŠ¨ä½œç±»å‹çš„CSSç±»
        function getActionClass(actionType) {
            switch (actionType) {
                case 0: return "action-shift";
                case 1: return "action-reduce";
                case 2: return "action-accept";
                case 3: return "action-error";
                default: return "";
            }
        }
        
        // æ ¼å¼åŒ–ç¬¦å·æ˜¾ç¤º
        function formatSymbol(symbol, type) {
            const className = type === "terminal" ? "terminal" : "non-terminal";
            const displaySymbol = symbol.replace(/ /g, 'ğŸ”¸');
            return `<span class="${className}">${displaySymbol}</span>`;
        }
        
        // æ ¼å¼åŒ–é¡¹ç›®æ˜¾ç¤ºï¼Œå°†ç‚¹å·æ›¿æ¢ä¸ºâ¬‡ï¸
        function formatItem(nonTerminal, production, dotPosition) {
            let result = `${formatSymbol(nonTerminal, "non-terminal")} â†’ `;
            
            for (let i = 0; i < production.length; i++) {
                if (i === dotPosition) {
                    result += "â¬‡ï¸ ";
                }
                result += formatSymbol(production[i].value, production[i].type) + " ";
            }
            
            if (dotPosition === production.length) {
                result += "â¬‡ï¸";
            }
            
            return result;
        }
        
        // åŠ è½½JSONæ•°æ®
        fetch('slr_parser.json')
            .then(response => response.json())
            .then(data => {
                // æå–æ‰€æœ‰ç»ˆç»“ç¬¦å’Œéç»ˆç»“ç¬¦
                const terminals = new Set();
                const nonTerminals = new Set();
                
                data.productions.forEach(prod => {
                    nonTerminals.add(prod.left);
                    prod.right.forEach(symbol => {
                        if (symbol.type === "terminal") {
                            terminals.add(symbol.value);
                        } else {
                            nonTerminals.add(symbol.value);
                        }
                    });
                });
                
                // æ·»åŠ ç»“æŸç¬¦å·
                terminals.add("#");
                
                // æ›´æ–°è¡¨å¤´
                const tableHeader = document.getElementById("table-header");
                const actionColspan = document.getElementById("action-colspan");
                const gotoColspan = document.getElementById("goto-colspan");
                
                actionColspan.setAttribute("colspan", terminals.size);
                gotoColspan.setAttribute("colspan", nonTerminals.size);
                
                // æ·»åŠ ACTIONåˆ—
                terminals.forEach(terminal => {
                    const th = document.createElement("th");
                    th.innerHTML = formatSymbol(terminal, "terminal");
                    tableHeader.appendChild(th);
                });
                
                // æ·»åŠ GOTOåˆ—
                nonTerminals.forEach(nonTerminal => {
                    const th = document.createElement("th");
                    th.innerHTML = formatSymbol(nonTerminal, "non-terminal");
                    tableHeader.appendChild(th);
                });
                
                // å¡«å……è¡¨æ ¼å†…å®¹
                const tableBody = document.getElementById("table-body");
                const stateCount = data.action_table.length;
                
                for (let i = 0; i < stateCount; i++) {
                    const tr = document.createElement("tr");
                    
                    // çŠ¶æ€ç¼–å·
                    const tdState = document.createElement("td");
                    tdState.textContent = i;
                    tr.appendChild(tdState);
                    
                    // ACTIONéƒ¨åˆ†
                    const actionRow = data.action_table[i];
                    terminals.forEach(terminal => {
                        const td = document.createElement("td");
                        if (actionRow.actions[terminal]) {
                            const action = actionRow.actions[terminal];
                            td.textContent = action.display;
                            td.className = getActionClass(action.type);
                        }
                        tr.appendChild(td);
                    });
                    
                    // GOTOéƒ¨åˆ†
                    const gotoRow = data.goto_table[i];
                    nonTerminals.forEach(nonTerminal => {
                        const td = document.createElement("td");
                        if (gotoRow.gotos[nonTerminal] !== undefined) {
                            td.textContent = gotoRow.gotos[nonTerminal];
                        }
                        tr.appendChild(td);
                    });
                    
                    tableBody.appendChild(tr);
                }
                
                // å¡«å……é¡¹ç›®é›†
                const itemSetsContainer = document.getElementById("item-sets-container");
                
                data.item_sets.forEach((itemSet, index) => {
                    const itemSetDiv = document.createElement("div");
                    itemSetDiv.className = "item-set";
                    
                    const header = document.createElement("div");
                    header.className = "item-set-header";
                    header.textContent = `çŠ¶æ€ ${itemSet.state}`;
                    itemSetDiv.appendChild(header);
                    
                    itemSet.items.forEach(item => {
                        const itemDiv = document.createElement("div");
                        itemDiv.className = "item";
                        itemDiv.innerHTML = formatItem(item.non_terminal, item.production, item.dot_position);
                        itemSetDiv.appendChild(itemDiv);
                    });
                    
                    itemSetsContainer.appendChild(itemSetDiv);
                });
                
                // å¡«å……äº§ç”Ÿå¼
                const productionList = document.getElementById("production-list");
                
                data.productions.forEach(prod => {
                    const productionDiv = document.createElement("div");
                    productionDiv.className = "production";
                    
                    let html = `${prod.index}: ${formatSymbol(prod.left, "non-terminal")} â†’ `;
                    
                    prod.right.forEach(symbol => {
                        html += formatSymbol(symbol.value, symbol.type) + " ";
                    });
                    
                    productionDiv.innerHTML = html;
                    productionList.appendChild(productionDiv);
                });
            })
            .catch(error => {
                console.error('Error loading SLR parser data:', error);
                alert('åŠ è½½SLRè§£æå™¨æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®ä¿å·²ç”Ÿæˆslr_parser.jsonæ–‡ä»¶ã€‚');
            });
    </script>
</body>
</html>